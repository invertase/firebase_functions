# .gitignore Configuration Guide

This document explains the .gitignore setup for the Firebase Functions Dart project.

## Structure

The project has three .gitignore files:

```
firebase-functions-dart/
├── .gitignore                    # Main package ignores
├── example/
│   ├── basic/
│   │   └── .gitignore           # Dart example ignores
│   └── nodejs_reference/
│       └── .gitignore           # Node.js reference ignores
```

## Main Package (.gitignore)

Located at the root of `firebase-functions-dart/`, this covers:

### Dart & Flutter
- `.dart_tool/` - Build tool directory
- `.packages` - Package resolution (deprecated)
- `build/` - Compiled output
- `pubspec.lock` - Dependency lock file (commented for packages)
- `*.g.dart` - Generated files from build_runner
- `coverage/` - Test coverage data

### Firebase
- `.firebase/` - Firebase cache
- `firebase-debug.log` - Firebase CLI logs
- `firestore-debug.log` - Firestore emulator logs

### Node.js (for examples)
- `node_modules/` - Node.js dependencies
- `npm-debug.log` - NPM logs
- `package-lock.json` in examples (but kept for nodejs_reference)

### IDEs
- `.vscode/` - VS Code settings
- `.idea/` - IntelliJ/Android Studio settings
- `*.iml` - IntelliJ module files

### OS-Specific
- `.DS_Store` - macOS Finder metadata
- `Thumbs.db` - Windows thumbnail cache
- `*~` - Linux backup files

### Generated Artifacts
- `nodejs_manifest.json` - Regenerated in CI
- `doc/api/` - Generated documentation

## Example: Basic (.gitignore)

Located in `example/basic/`, focused on Dart development:

```gitignore
# Dart build artifacts
.dart_tool/
.packages
build/

# Generated files
*.g.dart

# Firebase Functions manifest (commented - kept for snapshot tests)
# functions.yaml

# IDE & OS
.vscode/
.DS_Store
```

**Note**: The `functions.yaml` is kept in version control for snapshot testing. In a production project, you might want to uncomment the ignore rule.

## Test Fixtures: Node.js Reference (.gitignore)

Located in `test/fixtures/nodejs_reference/`, standard Node.js ignores plus:

```gitignore
# Generated manifest (regenerated in CI and snapshot tests)
nodejs_manifest.json
```

This file is regenerated on demand via:
```bash
GCLOUD_PROJECT="test-project" PORT="8080" FUNCTIONS_CONTROL_API="true" \
  npx firebase-functions &
curl http://localhost:8080/__/functions.yaml > nodejs_manifest.json
```

## Important Notes

### Files Tracked in Git

These generated files **are** tracked for snapshot testing:
- `example/basic/functions.yaml` - Dart manifest
- `test/fixtures/nodejs_reference/package-lock.json` - For CI caching

These files are **ignored** and regenerated:
- `test/fixtures/nodejs_reference/nodejs_manifest.json` - Regenerated in CI

### Package vs Application

The main `pubspec.lock` is **commented out** by default because this is a package. Uncomment if creating an application:

```gitignore
# Uncomment for applications:
pubspec.lock
```

### CI Artifacts

The following are generated in CI and don't need to be committed:
- Build outputs from `dart run build_runner build`
- Test coverage reports
- Temporary log files
- Node.js manifest snapshots

## Adding to Your Project

If you're using this package in your project, create a similar structure:

```gitignore
# Your functions directory
functions/

# Dart build artifacts
.dart_tool/
.packages
build/

# Generated files
*.g.dart

# Firebase
.firebase/
firebase-debug.log

# IDE
.vscode/
.idea/

# OS
.DS_Store
```

## Maintenance

### When to Update

Update .gitignore when:
- Adding new build tools or generators
- New IDEs or editors in use
- New generated file patterns appear
- New CI artifacts need exclusion

### Checking Ignored Files

See what's being ignored:
```bash
git status --ignored
```

Force add an ignored file (if needed):
```bash
git add -f path/to/file
```

Check if a file is ignored:
```bash
git check-ignore -v path/to/file
```

## Common Issues

### Functions.yaml Not Generated

If `functions.yaml` isn't appearing:
1. Check it's not ignored (shouldn't be by default)
2. Run `dart run build_runner build`
3. Verify `build.yaml` is configured correctly

### Node Modules Committed by Accident

If `node_modules/` was committed:
```bash
git rm -r --cached test/fixtures/nodejs_reference/node_modules
git commit -m "Remove node_modules from git"
```

### Generated Files in History

To remove accidentally committed generated files:
```bash
# Remove file from history (careful!)
git filter-branch --tree-filter 'rm -rf .dart_tool' HEAD
# or use git-filter-repo (recommended)
```

## References

- [Dart .gitignore Template](https://github.com/dart-lang/sdk/blob/main/.gitignore)
- [Node.js .gitignore Template](https://github.com/github/gitignore/blob/main/Node.gitignore)
- [GitHub .gitignore Templates](https://github.com/github/gitignore)
- [Firebase .gitignore](https://firebase.google.com/docs/hosting/full-config#ignore)
